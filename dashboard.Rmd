---
title: "Bedingte relative Häufigkeiten"
author: "EAkhmerova"
date: "2023-07-03"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(graphics)
library(sortable)
tutorial_options(exercise.timelimit = 90)
knitr::opts_chunk$set(echo = TRUE)
```

## Einführung

```{r intro, echo=FALSE}
shiny::tabsetPanel(
  id = "myAccordion",
  # Panel 1
  shiny::tabPanel(
    title = "Start",
    value = "panel1",
    htmltools::HTML("
      <p>Das Einkaufsteam einer Edinburger Bäckerei hat bei der Einkaufsplanung und Überprüfung gemerkt, dass bestimmte Produktgruppen in den letzten Monaten deutlich öfter als andere nachgekauft werden müssen, während andere ab und zu verderben bzw. weggeworfen werden müssen, weil sie schon über dem Verfalldatum sind. Dadurch entstehen Kosten und die Bäckerei verliert das Geld, das sonst dem Modernisierungswunsch des Geschäftsführers zufolge in die Erneuerung der Innenausstattung investiert werden könnte.</p>
      <p>Das Einkaufsteam hat in Kooperation mit dem Verkaufsteam bestimmte Verhaltensmuster der Käufer/innen vermutet und möchte ihre Behauptungen nun überprüfen. Zum Glück haben die Bäckereimitarbeiter/innen alle Transaktionen sorgfältig im Transaktionsmanagement-System abgespeichert, so dass alle Daten zu den Transaktionen zwischen dem 01.11.2016 und 30.03.2017 zur Verfügung stehen und zwar:</p>
      <ul>
        <li>Transaktionsnummer,</li>
        <li>Name der Ware,</li>
        <li>Transaktionsdatum und -uhrzeit,</li>
        <li>Tageszeit,</li>
        <li>Wochentag/Wochenende.</li>
      </ul>
      
      <p>Überlege dir, wie die Bäckereimitarbeiter/innen ihre Analyse durchführen und nach Kaufmustern suchen könnten und klicke dann auf die Reiter, um Einblicke in den Analyseprozess vom Einkaufsteam zu bekommen.</p>
    ")
  ),
  # Panel 2
  shiny::tabPanel(
    title = "Zusammenhänge zwischen Produkten und Tageszeiten",
    value = "panel2",
    htmltools::HTML("
      <p>Eine Sache, die die Mitarbeiter/innen der Bäckerei überprüft haben, war der Zusammenhang zwischen der Tageszeit und den gekauften Produkten uund zwar, ob bestimmte Waren abhängig von der Tageszeit mehr oder weniger nachgefragt waren. So war eine Hypothese, dass der Kaffee meist morgens und der Tee meist nachmittags getrunken wird. Um das zu überprüfen, hat man zuerst eine folgende Kontingenztabelle erstellt.</p>
      
      <img src='images/drink_daytime_contingency.png'>
      
      <p>Diese Tabelle beinhaltet absolute Häufigkeiten von den Fällen, wann der Kaffee vormittags (2561), der Kaffee nachmittags (2823), der Kaffee abends (87), der Tee vormittags (456), der Tee nachmittags (930) und der Tee abends (49). Und am Rande der Tabelle sind die Randhäufigkeiten aufgeführt - die Summen der jeweiligen Zeilen oder Spalten.</p>
      
      <p>Der Kaffee wurde an sich mehr verkauft und die Gruppe sind unterschiedlich groß, also haben die Mitarbeiter/innen die absolute Häufigkeiten für eine bessere Vergleichbarkeit in relative Häufigkeiten überführt. Dabei haben sie die Werte nicht durch die Gesamtsumme geteilt, sondern durch die entsprechende Randhäufigkeit - und somit bedingte relative Häufigkeiten gebildet.</p>
      
      <p>Da die Bedingung die Tageszeit war, hat man die absolute Häufigkeiten von einem Produkt pro eine bestimmte Tageszeit durch die Gesamthäufigkeit dieses Produkt geteilt - und so die Verteilung der Käufe vom Produkt über die drei Tageszeiten vernschaulicht. Die entstandene Tabelle kannst du hier unten sehen.</p>
      
      <img src='images/coffee_tea_conditional.png'>
      
      <p>Also man hat den Kaffee doch meist am Nachmittag und nicht am Vormittag bestellt, die Hypothese für den Tee hat sich aber bestätigt, er wurde auch am häufigsten verkauft, wenn es Nachmittag war.</p>
      
      <p>Anschließend hat man auch die Ergebnisse visualisiert, um die Erkenntnisse noch sichtbarer zu machen und auch den Kolleg/innen diese zeigen und den Standpunkt klarer machen zu können.</p>
      
      <p>So sah die erste Visualisierung aus:</p>
      
      <img src='images/coffee_tea_tree.png'>
      
      <p>Und so die zweite.</p>

      <img src='images/coffee_tea_mosaic.png'>
      
      <p>In den folgenden Abschnitten lernst du mehr über bedingte relative Häufigkeiten und am Ende wirst du auch solche Grafiken erstellen und lesen können. Klicke also weiter - und es geht los!</p>
    ")
  )
)
```

## Bedingte relative Häufigkeiten

Die Mitarbeiter/innen der Bäckerei haben in ihrer Analyse bedingte relative Häufigkeiten benutzt. Was ist das aber?

Die Häufigkeitsverteilung spielt in der Statistik eine große Rolle. Du weißt bestimmt schon über absolute und relative Häufigkeiten. Die letzten können weiterhin in bedingte relative Häufigkeiten umgewandelt werden.

**Bedingte relative Häufigkeiten werden als Verhältnis der Anzahl der Fälle, in denen ein bestimmtes Ereignis $A$ auftritt, unter der Bedingung, dass ein anderes Ereignis $B$ bereits eingetreten ist, zur Gesamtanzahl der Fälle, in denen Ereignis $B$ eingetreten ist, definiert.** Diese Definition lässt sich durch die folgende Formel mathematisch ausdrücken:

\[
f(A \big| B) = \frac{f(A, B)}{f(B)} = \frac{h(A, B)}{h(B)}
\]
wo $f(A \big| B)$ für die bedingte relative Häufigkeit von $A$ unter der Bedingung $B$, $h(A, B)$ für die absolute Häufigkeit der Kombination von $A$ und $B$ und $h(B)$ für die Randhäufigheit von $B$ steht.

Bedingte relative Häufigkeiten werden häufig für die Analyse und Interpretation von Daten verwendet. Sie helfen uns, Beziehungen zwischen Ereignissen zu untersuchen und zu bestimmen, ob bestimmte Faktoren voneinander abhängig sind oder nicht.

Dies findet eine praktische Anwendung in verschiedenen Bereichen. In der *Medizin* kann z.B. der Effekt einer Behandlung unter Berücksichtigung bestimmter Risikofaktoren eingeschätzt werden und in der *Wirtschaft* kann das Verbraucherverhalten in Bezug auf bestimmte Produkte analysiert werden.

Im nächsten Abschnitt lernst du noch einen Datensatz kennen, bei dem du mithilfe bedingter relativer Häufigkeiten bestimmte Vorhersagen treffen kannst. Dieser Datensatz wird dich auch weiterhin begleiten, wenn du mehr über graphische Darstellungen von bedingten relativen Häufigkeiten erfährst.

## Use Case: Titanic

Am 15. April 1912 ist das vermeintlich sicherste Schiff der Epoche *Titanic* auf einen Eisberg gestoßen und demzufolge versunken. Da unzureichend Rettungsboote an Bord waren, sind viele Menschen ums Leben gekommen - 1502 von 2224 Passagieren und Schiffsleuten sind tragisch gestorben.

Man kann das Überleben einiger Passagiere zwar mit ihrem Glück verbinden, es konnte aber bestimmte Umstände geben, unter denen die eine oder andere Person mehr Überlebenschancen hatte als andere. Diese Hypothese kann anhand des folgenden Datensatzes überprüft werden.

Führe den Code unten aus, um mehr über die Tabelle zu erfahren, die wir des Weiteren benutzen werden. Sei frei, auch weitere Befehle zu schreiben und auszuführen, z.B. $head(titanic\_dt)$, um den Datensatz noch besser kennenzulernen.

```{r dataset, exercise=TRUE}
# .csv-Datei einlesen
titanic_dt <- read.csv("data/titanic.csv")

# Grundinformationen ausgeben lassen
summary(titanic_dt)  # achte auf die Anzahl der Reihen und Spalten
str(titanic_dt)  # ein Überblick von Spaltennamen und Ausprägungen der Werte
```

## Häufigkeitsbäume

Bedingte relative Häufigkeiten lassen sich mit Hilfe von **Häufigkeitsbäumen**, manchmal auch als **Baumdiagramme** oder auch **Wahrscheinlichkeitsbäume** genannt, visualisieren.

Wie der Name schon verrät, hat diese Visualisierung eine Form vom Baum - es gibt:

- eine **Wurzel** - einen Ausgangspunkt des Baumdiagramms,
- **Äste** - Abspaltungen aus den Knotenpunkten, die eine Bedingung oder Entscheidung widerspiegeln, die zu einem bestimmten Ereignis führt,
- und schließlich **Blätter** - finale Ergebnisse, zu denen eine Reihe von verschiedenen möglichen Ereignissen geführt hat.

An den Knotenpunkten kann man qualitative Zustände ablesen, die durch vorherige Ereignisse zustande gekommen sind, und die Äste werden mit prozentualen Werten beschriften, die zeigen, wie wahrscheinlich das jeweilige Szenario ist.

```{r fig1, echo = FALSE, out.width = "100%", fig.cap = "Von den 891 Menschen, die an Bord waren, waren 577 Männer (ca. 64,8%) und 314 Frauen (ca. 35,2%). 81,1% der Männer (468 Menschen) sind ums Leben gekommen, unter Frauen waren das hingegen nur 25,8% (81). Die Überlebensquote von Frauen war also 74,2% (233) und von Männern 18,9% (109)."}
knitr::include_graphics("images/sex_tree.png")
```

Klicke nun weiter, um zu lernen, wie man diese Informationen interpretieren kann und wie man Häufigkeitsbäume überhaupt liest.

## Häufigkeitsbäume lesen

Bleiben wir am besten bei demselben Diagramm. Wie schon im vorherigen Abschnitt angedeutet, waren von den 891 Menschen, die an Bord waren, 577 Männer und 314 Frauen. 81,1% der Männer sind ums Leben gekommen, unter Frauen waren das hingegen nur 25,8%. Lassen wir aber alle anderen Informationen direkt vom Diagramm ablesen und interpretieren:

```{r fig2, echo = FALSE, out.width = "100%"}
knitr::include_graphics("images/sex_tree.png")
```

Fangen wir mit der Wurzel, den Knoten und den Blättern an.
```{r hbread1, echo=FALSE}
quiz(
  caption = "",
  question("Was ist die Wurzel?",
           answer("männlich, weiblich"),
           answer("N", correct = TRUE, message = "*N* steht für die Gesamtanzahl der Passagiere, die daraufhin in Unterkategorien aufgeteilt wird."),
           answer("überlebt, nicht überlebt"),
           allow_retry = TRUE),
  question("Gehen wir weiter zu den inneren Knoten. Wie heißen diese?",
           answer("männlich, weiblich", correct = TRUE, message = "Die Gesamtanzahl der Passagiere wird erstmals nach Geschlecht aufgeteilt. Bei den Prozentwerten geht es an dieser Stelle noch um relative Häufigkeiten ohne jegliche Bedingung."),
           answer("N"),
           answer("überlebt, nicht überlebt"),
           allow_retry = TRUE),
  question("Und jetzt gehen wir noch weiter nach unten zu den Endknoten - den Blättern und zwar...",
           answer("männlich, weiblich"),
           answer("N"),
           answer("überlebt, nicht überlebt", correct = TRUE, message = "Das sind die Endzustände, zu denen bestimmte vorherige Ereignisse oder wie hier Eigenschaften geführt haben."),
           allow_retry = TRUE)
)
```

Super! Jetzt bleiben nur die Ästebeschriftungen.
```{r hblesen2, echo=FALSE}
quiz(
  caption = "",
  question("35,2% der Passagiere waren Frauen, also f(Frau) = 35,2%. Was ist dann f(Mann) = ...?",
           answer("65,8%"),
           answer("70%"),
           answer("64,8%", correct = TRUE, message = "Auf diese Antwort kannst du kommen, nicht nur indem du von 100% 35,2% extrahierst, sondern wenn du an die Beschriftung vom Pfeil links oben schaust, der von *N* zu *Männlich* geht."),
           allow_retry = TRUE),
  question("Und was für eine Häufigkeit ist das?",
           answer("relative Häufigkeit", correct = TRUE, message = "Das ist noch der Anteil der Männer an den Passagieren ohne jegliche Bedingung, also es geht um eine relative Häufigkeit."),
           answer("bedingte relative Häufigkeit"),
           allow_retry = TRUE),
  question("Schaue dir jetzt die Beschriftungen der unteren Ästen an. Achte auf den Weg, über den man zum jeweiligen Endpunkt kommt. Welcher Anteil der Frauen hat überlebt bzw. was ist f(überlebt | Frau)?",
           answer("25,8%"),
           answer("74,2%", correct = TRUE, message = "So wird der Pfeil zwischen *Weiblich* und *Überlebt* beschriftet."),
           answer("18,9%"),
           answer("81,1%"),
           allow_retry = TRUE),
  question("Und welcher Anteil der Passagiere ist gestorben, wenn sie Frauen waren?",
           answer("25,8%", correct = TRUE, message = "Die Zahl steht neben dem Ast zwischen *Weiblich* und *Gestorben*, lässt sich aber auch als 100 - 74,2 berechnen."),
           answer("74,2%"),
           answer("18,9%"),
           answer("81,1%"),
           allow_retry = TRUE),
  question("Welcher Anteil der Passagiere hat überlebt, unter der Bedingung dass sie Männer waren, also was ist f(überlebt | Mann)?",
           answer("25,8%"),
           answer("74,2%"),
           answer("18,9%", correct = TRUE, message = "Siehe die Beschriftung unten ganz links zwischen *Männlich* und *Überlebt*"),
           answer("81,1%"),
           allow_retry = TRUE),
  question("Vervollständige letztlich diesen Satz: Die relative Häufigkeit der gestorbenen Passagiere, die Männer waren, beträgt _________. Es geht dabei um eine ____________ Häufigkeit.",
           answer("81,1%, relative"),
           answer("25,8%, bedingte relative"),
           answer("25,8%, relative"),
           answer("81,1%, bedingte relative", correct = TRUE, message = "Genau, an dieser Stelle gibt es schon eine Bedingung für das Überleben oder Sterben und zwar das Geschlecht. *Note:* Das muss keine kausale Bedingung sein, die Kausalität wird mithilfe anderer Instrumente bestätigt oder nicht bestätigt."),
           allow_retry = TRUE)
)
```

Nun weißt du, wie man Häufigkeitsbäume lesen und interpretieren kann. Klicke weiter, um nun zu lernen, wie sie erstellt werden.

## Häufigkeitsbäume erstellen

Neben Geschlecht und Passagierklasse gab es noch ein Merkmal, das theoretisch bei den Überlebungschancen mitspielen könnte und zwar das Alter. Ob Kinder und Jugendliche als Erste ihre Plätze in den Rettungsbooten finden konnten, werden wir jetzt untersuchen.

Von den 891 Passagieren und Schiffsleuten waren 164 (18,4%) unter 20 Jahren und 727 (81,6%) 20 Jahre alt oder älter. Von der ersten Gruppe haben 48,2% (79 Menschen) überlebt und entsprechend sind 51,8% (85) ums Leben gekommen. Und von den Erwachsenen sind 38,4% (276) am Leben geblieben und 61,6% (451) gestorben. Also hatten die jüngeren Menschen anscheinend fast die gleichen Überlebenschancen wie die älteren, zumindest wenn man die Altersgrenze bei 20 setzt.

Schauen wir jetzt, wie sich diese Informationen mit einem Häufigkeitsbaum veranschaulichen lassen, und versuchen wir die fehlenden Informationen zu vervollständigen.

```{r fig3, echo = FALSE, out.width = "100%"}
knitr::include_graphics("images/age_tree_gaps.png")
```

Versuche das erstmals selbst zu lösen.

```{r ex1, echo = FALSE}
quiz(caption = "",
     question("Was soll laut der Beschreibung oben in den Lücken stehen?",
              answer("1 - Erwachsene/r, 2 - Kind, 3 - Nicht Überlebt, 4 - Überlebt"),
              answer("1 - Kind, 2 - Erwachsene/r, 3 - Überlebt, 4 - Nicht Überlebt", 
                     correct = TRUE),
              answer("1 - Kind, 2 - Erwachsene/r, 3 - Nicht Überlebt, 4 - Überlebt"),
              answer("1 - Erwachsene/r, 2 - Kind, 3 - Überlebt, 4 - Nicht Überlebt "),
              allow_retry = TRUE))
```

Nur wenn du gar nicht weiterkommst, scrolle für die Lösung nach unten.

.

.

.

```{r fig4, echo = FALSE, out.width = "100%", fig.cap = "An den Ästen wurden schon die Prozentwerte geschrieben. 18,4% aller Menschen waren unter 20 und 81,6% Erwachsene, deswegen soll im Kasten links \"Kind\" und im Kasten rechts \"Erwachsene/r\" stehen. Und von den Erwachsenen sind 61,6% gestorben und 38,4% wurden gerettet. Von daher soll unten links \"Überlebt\" und unten rechts \"Nicht Überlebt\" stehen."}
knitr::include_graphics("images/age_tree.png")
```

In dieser Übung wurden nicht alle Knoten beschriftet. Wie wäre es, wenn nicht alle Prozentwerte bei den Ästen angegeben werden? Nehmen wir dafür die Überlebensquote unter der Bedingung, dass die Person in der 1., 2. oder 3. Klasse Passagier war, als Beispiel.

Die Häufigkeitsverteilung hinsichtlich der Passagierklasse sah so aus:

- 216 Menschen (24,24%) waren in der 1. Klasse (136 (62,96%) haben überlebt und 80 (37,04%) nicht),

- 184 Menschen (20,65%) waren in der 2. Klasse (87 (47,28%) haben überlebt und 97 (52,72%) nicht),

- 491 Menschen (55,11%) waren in der 3. Klasse (119 (24,24%) haben überlebt und 372 (75,76%) nicht).

```{r fig5, echo = FALSE, out.width = "100%", fig.cap = "Diese Informationen findet man auf dieser Grafik wieder, aber die Äste werden nicht beschriftet. Kannst du zuordnen, welche Zahlen von links nach rechts von oben nach unten stehen sollen?"}
knitr::include_graphics("images/class_tree_gaps.png")
```

Versuche das erstmals selbst zu lösen. Welche Zahlen sollen in den Lücken stehen?

```{r ex2, echo = FALSE}
quiz(caption = "",
  question("a)______",
           answer("62.96", correct = TRUE),
           answer("67.92"),
           answer("75.76"),
           allow_retry = TRUE
  ),
  question("b)______",
           answer("52.72"),
           answer("24.24"),
           answer("37.04", correct = TRUE),
           allow_retry = TRUE
  ),
  question("c)______",
           answer("52.72"),
           answer("48.38"),
           answer("47.28", correct = TRUE),
           allow_retry = TRUE
  ),
  question("d)______",
           answer("52.62"),
           answer("52.72", correct = TRUE),
           answer("47.28"),
           allow_retry = TRUE
  ),
  question("e)______",
           answer("23.24"),
           answer("37.04"),
           answer("24.24", correct = TRUE),
           allow_retry = TRUE
  ),
  question("f)______",
           answer("75.76", correct = TRUE),
           answer("76.75"),
           answer("62.96"),
           allow_retry = TRUE
  )
)
```

Nur wenn du gar nicht weiterkommst, scrolle für die Lösung nach unten.

.

.

.

```{r fig6, echo = FALSE, out.width = "100%", fig.cap = "Bei der Lösung fangen wir von oben an und schauen, wie viel Prozent bei welcher Kategorie angegeben wurde. Das gleiche machen wir auf der unteren Ebene. Eine etwas schwierigere Aufgabe wäre, die Prozentwerte bei den Unterkategorien anhand absoluter Werte selbst zu berechnen, dazu kommen wir aber ein bisschen später."}
knitr::include_graphics("images/class_tree.png")
```

Nun kannst du schon Häufigkeitsbäume selbst lesen, interpretieren und erstellen und kannst zum nächsten Thema **Mosaikplots** übergehen.

## Mosaikplot

Eine weitere graphische Darstellung von bedingten relativen Häufigkeiten sind **Mosaikplots**, auch als **Mosaikdiagramme** oder **Mosaikgrafiken** bezeichnet.

Im Mosaikplot wird eine rechteckige Fläche in Rechtecke aufgeteilt. Die Größe dieser Rechtecke ist proportional zur relativen Häufigkeit der entsprechenden Kategorie. Die größeren Rechtecke des Mosaikplots werden in Segmente unterteilt, die die Kategorien der beiden Variablen darstellen.

```{r fig7, echo=FALSE, out.width="100%"}
knitr::include_graphics("images/sex_mosaic.png")
```

Damit zusätzliche Informationen noch anschaulicher sind, können die Segmente farblich markiert oder schattiert werden.

```{r fig8, echo=FALSE, out.width="100%"}
knitr::include_graphics("images/sex_mosaic_shades.png")
```

Wenn man auf die Achsen der Grafik schaut, repräsentiert die horizontale Achse eine unabhängige und die vertikale Achse eine abhängige Variable. *Zur Erinnerung: Eine abhängige Variable ist eine Variable, die sich durch die Veränderung der unabhängigen Variable auch ändert. Und eine unabhängige Variable ist dementsprechend von der anderen Variable unabhängig.*

So ist hier das Geschlecht die unabhängige und das Überleben die abhängige Variable. Tatsächlich sieht man, dass die meisten Männer ums Leben gekommen sind, während die meisten Frauen überlebt haben. Schauen wir mal, wie das in Zahlen aussieht. Führe dafür den Code unten aus.

```{r bsp1, exercise = TRUE}
# Daten einlesen und Variablen definieren
titanic_dt <- read.csv("data/titanic.csv")

# Absolute Häufigkeiten
maenner <- nrow(titanic_dt[titanic_dt$Sex == "male",])
frauen <- nrow(titanic_dt[titanic_dt$Sex == "female",])
n_total <- nrow(titanic_dt)

maenner_ueberlebt <- nrow(titanic_dt[(titanic_dt$Sex == "male") 
                                     & (titanic_dt$Survived == 1),])
maenner_gestorben <- nrow(titanic_dt[(titanic_dt$Sex == "male") 
                                     & (titanic_dt$Survived == 0),])
frauen_ueberlebt <- nrow(titanic_dt[(titanic_dt$Sex == "female") 
                                     & (titanic_dt$Survived == 1),])
frauen_gestorben <- nrow(titanic_dt[(titanic_dt$Sex == "female") 
                                     & (titanic_dt$Survived == 0),])

# Ausgabe von Erkenntnissen
print(paste0("Die relative Häufigkeit vom Überleben war ", 
             round(maenner_ueberlebt / maenner * 100, 2), 
             "%, wenn die Passagiere männlich waren, und ", 
             round(frauen_ueberlebt / frauen * 100, 2), 
             "%, wenn sie Frauen waren. Die relative Häufigkeit vom Sterben war ", 
             "hingegen ", round(maenner_gestorben / maenner * 100, 2), 
             "% unter der Bedingung, dass die Passagiere männlich waren, und ",
             round(frauen_gestorben / frauen * 100, 2), "% unter der Bedingung, ", 
             "dass sie weiblich waren."))
```

Klicke nun weiter, um zu lernen, wie man Häufigkeitsbäume liest.

## Mosaikplot lesen

Schaue dir ein folgendes Mosaikplot an und probiere, auf die folgenden Fragen zu antworten. Es zeigt die relativen Häufigkeiten des Überlebens bzw. Sterbens unter der Bedingung, dass man in einer bestimmten Passagierklasse unterwegs war, nun aber nicht in Form eines Häufigkeitsbaums, sondern als Mosaikdiagramm.

```{r fig9, echo = FALSE, out.width = "100%"}
knitr::include_graphics("images/class_mosaic.png")
```

```{r mpread, echo=FALSE}
quiz(
  caption = "",
  question("Was für eine Variable ist die Variable mit dem Wert *überlebt*?",   # add messages!!!
           answer("unabhängige Variable"),
           answer("abhängige Variable", correct = TRUE),
           allow_retry = TRUE),
  question("Welche Werte nimmt die unabhängige Variable in diesem Beispiel ein?",
           answer("*1. Klasse, 2. Klasse, 3. Klasse*", correct = TRUE),
           answer("*überlebt, nicht überlebt*"),
           allow_retry = TRUE),
  question("Aus welcher Klasse stammte die Mehrheit der Passagiere?",
           answer("1. Klasse", 
                  message = "Achte auf die horizontale Achse und die Länge der Rechtecke"),
           answer("2. Klasse", 
                  message = "Achte auf die horizontale Achse und die Länge der Rechtecke"),
           answer("3. Klasse", correct = TRUE,
                  message = paste0("Schaue dir die Seiten der Rechtecke an, die mit ",
                  "unterschiedlichen Klassen beschriftet werden. Die längste Seite verrät, ",
                  "dass es sich dabei um die größte Gruppe aus der nachgefragten Kategorie ",
                  "geht.")),
           allow_retry = TRUE),
  question("In welcher Klasse musste man sein, um die besten Überlebungschancen zu haben?",
           answer("1. Klasse", correct = TRUE, 
                  message = paste0("Schaue dir nun die vertikale Achse an. Bei der 1. Klasse ",
                                   "ist die Seite bei der entsprechenden Beschriftung ",
                                   "(*überlebt*) am längsten.")),
           answer("2. Klasse", 
                  message = "Achte auf die vertikale Achse und die Länge der Rechtecke"),
           answer("3. Klasse", 
                  message = "Achte auf die vertikale Achse und die Länge der Rechtecke"),
           allow_retry = TRUE),
  question(paste0("Setze den Satz fort: Man hatte die geringsten Chancen zum Überleben, unter ",
                  "der Bedingung, dass man Passagier der ..."),
           answer("... 1. Klasse war."),
           answer("... 2. Klasse war."),
           answer("... 3. Klasse war.", correct = TRUE, 
                  message = paste0("Genau dieses Rechteck hat die längste Seite, die mit ",
                  "*nicht überlebt* beschriftet wird.")),
           allow_retry = TRUE)
)
```

Nun weißt du, wie man Häufigkeitsbäume lesen und interpretieren kann. Klicke weiter, um nun zu lernen, wie sie erstellt werden.

## Mosaikplot erstellen

Im Abschnitt **Mosaikplot erstellen** hast du die Häufigkeitsverteilung nach Alter untersucht und die Beschriftungen vervollständigt. Wie wäre es nun mit einem entsprechenden Mosaikplot?

```{r fig10, echo = FALSE, out.width = "100%", fig.cap = "Auf dieser Grafik werden die Verteilung nach Alter und die Überlebungsquote gezeigt. Was soll laut der Beschreibung oben in den Lücken stehen?"}
knitr::include_graphics("images/age_mosaic_gaps.png")
```

Entnehme diesmal die Informationen nicht einer Textbeschreibung, sondern dem Häufigkeitsbaum.

```{r fig11, echo = FALSE, out.width = "100%"}
knitr::include_graphics("images/age_tree.png")
```

```{r mp_write1, echo=FALSE}
quiz(
  caption = "",
  question("1. Was soll in der Lücke *a)______* stehen?",
           answer("Kind", message = paste0("Diese Seite des Rechtecks sieht länger als die vom ",
                                           "Rechteck daneben. Schaue dir den oberen Teil des ",
                                           "Häufigkeitsbaums an. Wer bildete die größere ",
                                           "Gruppe?")),
           answer("Erwachsene/r", correct = TRUE),
           allow_retry = TRUE),
  question("2. Was soll in der Lücke *b)______* stehen?",
           answer("Kind", correct = TRUE),
           answer("Erwachsene/r", message = paste0("Diese Seite des Rechtecks sieht kleiner ",
                                                   "als die vom Rechteck daneben. Schaue dir ",
                                                   "den oberen Teil des Häufigkeitsbaums an. ",
                                                   "Wer bildete die kleinere Gruppe?")),
           allow_retry = TRUE),
  question("3. Wöfür steht *0* auf der Y-Achse?",
           answer("Überlebt", message = paste0("Diese Seite des Rechtecks sieht länger als die ",
                                               "vom Rechteck unten. Schaue dir den unteren ",
                                               "Teil des Häufigkeitsbaums an. Wer bildete die ",
                                               "größere Gruppe unter den Erwachsenen?")),
           answer("Nicht überlebt", correct = TRUE),
           allow_retry = TRUE),
  question("4. Wofür steht *1* auf der Y-Achse?",
           answer("Überlebt", correct = TRUE),
           answer("Nicht überlebt", message = paste0("Diese Seite des Rechtecks sieht länger ",
                                                     "als die vom Rechteck unten. Schaue dir ",
                                                     "den unteren Teil des Häufigkeitsbaums ",
                                                     "an. Wer bildete die größere Gruppe ",
                                                     "unter den Erwachsenen?")),
           allow_retry = TRUE)
)
```

Nur wenn du gar nicht weiterkommst, scrolle für die Lösung nach unten.

.

.

.

```{r fig12, echo = FALSE, out.width = "100%"}
knitr::include_graphics("images/age_mosaic.png")
```

In der Übung, die du gerade gemacht hast, wurden nicht alle Segmente beschriftet. Wie wäre es, wenn nicht alle Prozentwerte angegeben werden? Diesmal wird die Aufgabe ein Stück komplexer sein, du bekommst aber auch eine Anleitung.

Kannst du dich noch an die Edinburger Bäckerei erinnern? In der Einleitung hast du gesehen, wie deren Einkaufsteam den Zusammenhang zwischen dem Kauf von Kaffee bzw. Tee und der Tageszeit untersucht hat. Sie haben aber auch eine weitere Hypothese überprüft und zwar, ob man besonders viel Kaffee kaufte, wenn es ein Arbeitstag war, und umgekehrt, ob man besonders viele Tassen Tee am Wochenende kaufte. Schaue dir die Kontingenztabelle an, die das Einkaufsteam erstellt hat.

```{r fig13, echo = FALSE, out.width = "100%", fig.cap="Hier werden alle absoluten Werte aufgeführt, die du brauchst, um das Mosaikplot zu erstellen."}
knitr::include_graphics("images/tea_coffee_weekday.png")
```

Vervollständige nun den folgenden Code, um ein Mosaikplot wie unten angeführt zu erstellen. Beachte, dass hier die bedingten relativen Häufigkeiten *f(Kaffee | Tag)* und *f(Tee | Tag)* zu berechnen sind, also die absoluten Häufigkeiten der jeweiligen Einzelfälle durch die Gesamthäufigkeit der **Produkte** und nicht der Wochentage zu teilen sind.

```{r mp_create, exercise=TRUE}
library(data.table)
library(treemap)

# Datei lesen
basket_dt <- fread("data/bread_basket.csv")

# Bedingte relative Häufigkeiten berechnen
# Berechnungsbeispiel:
anteil_kaffee_arbeitstag <- nrow(basket_dt[basket_dt$Item == "Coffee" 
                                          & basket_dt$weekday_weekend == "weekday"]
                                 ) / nrow(basket_dt[basket_dt$Item == "Coffee"])
# es wird also die Anzahl der Reihen, wo Item Kaffee war und am Arbeitstag gekauft wurde,
# durch die Anzahl der Reihen, wo Item Kaffee war, geteilt
anteil_kaffee_arbeitstag <- round(anteil_kaffee_arbeitstag * 100, 2) # für ein besseres Format

# Folge nun dem Beispiel und ersetze die Nullen mit eigenen Berechnungen
# Itemnamen sind Coffee und Tea und die Wochentagbezeichnungen sind weekday (Arbeitstag) und
# weekend (Wochenende):

anteil_kaffee_wochenende <- 0
anteil_tee_arbeitstag <- 0
anteil_tee_wochenende <- 0

# Kontingenztabelle erstellen - den restlichen Code kannst du einfach ausführen und das Ergebnis
# mit der Tabelle unten vergleichen
mosaic_dt <- data.table(Item = c(paste0("Kaffee: ", anteil_kaffee_arbeitstag, "%"), 
                                 paste0("Kaffee: ", anteil_tee_arbeitstag, "%"),
                                 paste0("Tee: ", anteil_kaffee_wochenende, "%"),
                                 paste0("Tee: ", anteil_tee_wochenende, "%")),
                        Wochentag = c("Arbeitstag", "Wochenende"),
                        Bedingte_relative_Häufigkeit = c(anteil_kaffee_arbeitstag, 
                                                         anteil_tee_arbeitstag, 
                                                         anteil_kaffee_wochenende, 
                                                         anteil_tee_wochenende))
treemap_weekday <- treemap(mosaic_dt, index = c("Wochentag", "Item"), 
                           vSize = "Bedingte_relative_Häufigkeit", vColor = "Item")
```

```{r fig14, echo = FALSE, out.width = "100%"}
knitr::include_graphics("images/tea_coffee_day_mosaic.png")
```

Man hat also auch am Wochenende viel Kaffee und Tee bestellt, gegeben, dass nur zwei Tage in die Kategorie fallen im Vergleich zu fünf Arbeitstagen.

## Quiz
Teste jetzt deine Kenntnisse! Hier findest du kurze Verständnisfragen und im nächsten Abschnitt **Programmieraufgaben** kannst du dann deine praktischen Fähigkeiten unter Beweis stellen.

```{r quiz1, echo=FALSE}
quiz(caption = "1. Definition",
     question("Was sind bedingte relative Häufigkeiten?",
              answer(paste0("Bedingte relative Häufigkeiten bezeichnen den Anteil ",
              "der Fälle, in denen ein bestimmtes Ereignis $A$ auftritt, unter der ",
              "Bedingung, dass ein anderes Ereignis $B$ bereits eingetreten ist, an ",
              "der Gesamtanzahl der Fälle.")),
              answer(paste0("Bedingte relative Häufigkeiten geben an, wie groß der ",
              "Anteil der absoluten Häufigkeit oder in anderen Worten der Anzahl ",
              "eines bestimmten Ereignisses an der Gesamtzahl der Versuche ist.")),
              answer(paste0("Bedingte relative Häufigkeiten bezeichnen den Anteil ",
              "der Fälle, in denen ein bestimmtes Ereignis $A$ auftritt, unter der ",
              "Bedingung, dass ein anderes Ereignis $B$ bereits eingetreten ist, an ",
              "der Gesamtanzahl der Fälle, in denen Ereignis $B$ eingetreten ist."), 
              correct = TRUE),
              allow_retry = TRUE))
```

```{r quiz2, echo=FALSE}
quiz(caption = "2. Anwendungsbereiche",
     question(paste0("Wo werden bedingte relative Häufigkeiten angewendet? Wähle ",
     "alle passenden Antworten."),
              answer(paste0("In der Medizin, z.B. zum Testen der Effizienz eines ",
              "neuen Wirkstoffes unter bestimmten Bedingungen."), correct = TRUE),
              answer(paste0("Beim Vergleich der Häufigkeitsverteilungen in mehreren ",
              "Gruppen unabhängig von deren Umfang.")),
              answer(paste0("Bei der Analyse des Verbraucherverhaltens bezüglich ",
              "bestimmter Produkte oder Produktgruppen."), correct = TRUE),
              answer(paste0("In soziologischen Studien bei der Untersuchung, ob ",
              "bestimmte soziodemografische Faktoren zu gewissen Handlungen, z.B. ",
              "zur Steuerkriminalität, führen können."), correct = TRUE),
              allow_retry = TRUE))
```

```{r quiz3, echo=FALSE}
quiz(caption = "3. Visualisierungsformen",
     question(paste0("a. Welche grafische Darstellungsformen gibt es für bedingte ",
     "relative Häufigkeiten ?"),
              answer("Histogramme"),
              answer("Häufigkeitsbäume", correct = TRUE),
              answer("Kreisdiagramme"),
              answer("Mosaikdiagramme", correct = TRUE),
              answer("Kontingenztabelle", correct = TRUE),
              allow_retry = TRUE))
```

```{r quiz4, echo=FALSE}
elements <- c("Äste", "Blätter", "Wurzel")
question_rank(paste0("**b. Häufigkeitsbäume haben eine baumähnliche Struktur. ",
                     "Sortiere die Namen der Elemente von Baumdiagrammen in der ",
                     " gleichen Reihenfolge wie deren Funktionen:**\n",
                     "- eine Bedingung oder Entscheidung widerspiegeln,\n",
                     "- Endereignis repräsentieren,\n",
                     "- Ausgangssituation darstellen."),
              answer(elements, correct = TRUE),
              answer(rev(elements), correct = FALSE, message = "Falsche Reihenfolge"),
              allow_retry = TRUE)
```

```{r quiz5, echo=FALSE}
variables <- c("abhängige Variable", "unabhängige Variable")
question_rank(paste0("**c. Sortiere die Variablentypen in der gleichen ",
              "Reihenfolge wie die folgenden Achsen eines Mosaikplots, ",
              "die sie repräsentieren:**\n- X-Achse,\n- Y-Achse"),
              answer(variables, correct = TRUE),
              answer(rev(variables), correct = FALSE, 
                     message = "Falsche Reihenfolge"),
              allow_retry = TRUE)
```


```{r fig15, echo = FALSE, out.width = "100%", fig.cap = "(1) Häufigkeitsbaum"}
knitr::include_graphics("images/item_weekday_tree.png")
```

```{r fig16, echo = FALSE, out.width = "100%", fig.cap = "(2) Mosaikdiagramm"}
knitr::include_graphics("images/item_weekday_mosaic.png")
```

```{r quiz6, echo=FALSE}
quiz(
  caption = "4. Interpretationsfragen",
  question(paste0("Schaue dir den obigen Häufigkeitsbaum (1) und das Mosaikdiagramm (2) an, ",
                  "das aus denselben Daten wie der Häufigkeitsbaum entstanden ist, und ",
                  "vervollständige es mit den Angaben, die du auf der ersten Grafik findest.\n", 
                  "a. Was kommt in die Lücke *a)* rein?"),
           answer("50.1%"),
           answer("49.1%"),
           answer("60.1%", correct = TRUE),
           answer("50.9%"),
           allow_retry = TRUE),
  question("b. Was kommt in die Lücke *b)* rein?",
           answer("Heiße Schokolade: 50.9", correct = TRUE),
           answer("Heiße Schokolade: 49.1"),
           answer("Sandwich: 49.1"),
           answer("Sandwich: 50.9"),
           allow_retry = TRUE),
  question("c. Was kommt in die Lücke *c)* rein?",
           answer("49.1%"),
           answer("39.9%", correct = TRUE),
           answer("60.1%"),
           answer("50.9%"),
           allow_retry = TRUE),
  question("d. Was kommt in die Lücke *d)* rein?",
           answer("Heiße Schokolade: 50.9"),
           answer("Heiße Schokolade: 49.1"),
           answer("Sandwich: 49.1", correct = TRUE),
           answer("Sandwich: 50.9"),
           allow_retry = TRUE)
)
```

## Programmieraufgaben

Hier kommt eine Aufgabe, die etwas tricky erscheinen kann, die aber dir zeigen kann, wie gut du das Thema bedingte relative Häufigkeiten verstanden hast.

Lese eine kurze Beschreibung und versuche daraus eine Kontigenztabelle zu erzeugen, wie im Text beschrieben.

**Zwischen 2016 und 2017 wurden in der Edinburger Bäckerei 1025 Kuchen und 3325 Brote verkauft. 40.29% der Kuchen wurde am Wochenende verkauft und 2092 Brote haben die Kund/innen an Arbeitstagen gekauft. Wie sehen die relativen Häufigkeiten beider Produkte unter der Bedingung, dass sie an einem bestimmten Wochentag verkauft wurden, aus? Beachte, dass du nur 2 Summen bilden musst, die 2 anderen sind als Platzhalter da.**

Für die Berechnungen benutze bitte die folgende Fläche und mache deine Berechnungen in R.

```{r prog, exercise=TRUE}
# Mache deine Berechnungen hier

```

```{r quiz8, echo=FALSE}
question("Sage aber erstmal, was die richtige Notation für diese Häufigkeiten ist.",
           answer("f(Produkt|Wochentag)", correct = TRUE),
           answer("f(Wochentag|Produkt)"),
           allow_retry = TRUE)
```

```{r fig17, echo=FALSE, out.width = "100%"}
knitr::include_graphics("images/test_dummy.png")
```

```{r quiz7, echo=FALSE}
quiz(
  caption = "Wähle die passende Antwort bzw. tippe die Zahl im Format 00.00 ein.",
  question_text("Was kommt in die Zelle (1)?",
                answer("59.71", correct = TRUE),
                answer_fn(function(value) {
                  if (value == "59,71") {
                    incorrect("Fast richtig! Beachte die Formatierung!")
                  }
                }),
           allow_retry = TRUE),
  question_text("Was kommt in die Zelle (2)?",
                answer("40.29", correct = TRUE),
                answer_fn(function(value) {
                  if (value == "40,29") {
                    incorrect("Fast richtig! Beachte die Formatierung!")
                  }
                }),
           allow_retry = TRUE),
  question("Was kommt in die Zelle (3)?",
           answer("100", correct = TRUE),
           answer("NA"),
           allow_retry = TRUE),
  question_text("Was kommt in die Zelle (4)?",
                answer("62.92", correct = TRUE),
                answer_fn(function(value) {
                  if (value == "62,92") {
                    incorrect("Fast richtig! Beachte die Formatierung!")
                  }
                }),
           allow_retry = TRUE),
  question_text("Was kommt in die Zelle (5)?",
                answer("37.08", correct = TRUE),
                answer_fn(function(value) {
                  if (value == "37,08") {
                    incorrect("Fast richtig! Beachte die Formatierung!")
                  }
                }),
           allow_retry = TRUE),
  question("Was kommt in die Zelle (6)?",
           answer("100", correct = TRUE),
           answer("NA"),
           allow_retry = TRUE),
  question("Was kommt in die Zelle (7)?",
           answer("100"),
           answer("NA", correct = TRUE),
           allow_retry = TRUE),
  question("Was kommt in die Zelle (8)?",
           answer("100"),
           answer("NA", correct = TRUE),
           allow_retry = TRUE)
)
```

## Feedback
Herzlichen Glückwunsch! Du hast eben das Erlernen der Thema *bedingte relative Häufigkeiten* beendet.

Danke, dass du diese E-Learning Plattform benutzt hast, hoffentlich kannst du das Thema bedingte relative Häufigkeiten nun deutlich besser verstehen.

Damit deine Erfahrung mit der aktualisierten Version dieser oder mit einer weiteren Plattform noch besser wird, möchte ich dich bitten, zum Abschluss an einer kleinen Umfrage teilzunehmen. Die Umfrage ist anonym und die erhobenen Daten werden ausschließlich zu Forschungszwecken verwendet.

Die Umfrage befindet sich auf einer externen Webseite. Beim Klick auf **Start** wirst du dahin weitergeleitet. Zur Teilnahme gib das Passwort "statistics23" ein.

```{js, echo=FALSE}
function redirect() {
  window.location.href = 'https://survey.lamapoll.de/Feedback-zum-Lerndashboard';
}
```

```{r, echo=FALSE}
HTML('<button onclick="redirect()">Start</button>')
```
